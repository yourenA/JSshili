<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>图片延迟加载示例 - 吃饱了还饿</title>
    <style>
        div {
            width: 400px;
            margin: 0 auto;
        }

        img {
            display: block;
            width: 400px;
            height: 250px;
            margin: 10px 0;
            background: url(https://www.denpe.com/assets/favicon.ico) no-repeat center;
        }
    </style>
</head>
<body>
<div>
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
    <img src="" data-src="https://www.denpe.com/example/1.jpg">
</div>
<script type="text/javascript">


    var imgs = document.body.querySelectorAll('img'),
            H = window.innerHeight;  //浏览器视窗高度
    function lazyload() {
        var S = document.documentElement.scrollTop || document.body.scrollTop;   //滚动条滚过高度
        [].forEach.call(imgs, function (img) {//将拥有length的对象可以使用array的foreach方法
            if (!img.getAttribute('data-src')) {
                return
            }  //已经替换过的跳过
            if (H + S - 200 > getTop(img)) {    //为达到演示效果，这里H+S减去200，延后加载时机
                img.src = img.getAttribute("data-src");
                img.removeAttribute("data-src");
            }
        });
        [].every.call(imgs, function (img) {
            return !img.getAttribute('data-src')
        }) && (window.removeEventListener("scroll", lazyload, false));   //完成所有替换后注销事件

    }

    window.addEventListener("scroll", lazyload, false);
    window.addEventListener("load", lazyload, false);

    function getTop(e) {
        var T = e.offsetTop;
        while (e = e.offsetParent) {
            T += e.offsetTop
        }
        return T
    }


</script>

</body>
</html>